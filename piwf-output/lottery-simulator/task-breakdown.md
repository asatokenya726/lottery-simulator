# 宝くじシミュレーター タスク分割表
> 最終更新: 2026-02-10
> MVP期間: 3週間（15営業日）
> 対応要件定義書: requirements-v1.1

---

## 依存関係図

```
Day 1: T-01（プロジェクトセットアップ）
         │
Day 2: T-02（型定義・設定） ─→ T-03（確率テーブル）
         │                        │
Day 3: T-04（LocalStorageラッパー）─┘
         │
Day 4: T-05（スキーママイグレーション）─→ T-06（GameState CRUD）
         │                                    │
Day 5: T-07（通貨管理）                 T-08（DrawHistory CRUD）
         │                                    │
Day 6-7: T-09（抽選エンジン）────────────────┘
         │
Day 7-8: T-10（資金補給）
         │
Day 8-9: T-11（統計計算）─→ T-12（useGameState）─→ T-13（useDrawHistory）
         │
Day 9-10: T-14（ガチャUI）─→ T-15（結果表示）─→ T-16（当選演出）
         │
Day 10-11: T-17（残高表示）─→ T-18（累計収支パネル）
         │
Day 11: T-19（資金補給通知）
         │
Day 11-12: T-20（注意喚起）─→ T-21（利用規約）
         │
Day 12: T-22（データリセット）─→ T-23（エラーハンドリング）
         │
Day 12-13: T-24（レスポンシブ調整）
         │
Day 13: T-25（SEO/OGP）
         │
Day 13-14: T-26（テスト作成 - ロジック層）
         │
Day 14: T-27（テスト作成 - データ層・フック層）
         │
Day 14-15: T-28（ブラウザテスト・最終調整）
```

---

## タスク一覧

### Phase A: 基盤構築（Day 1-3）

#### T-01: プロジェクトセットアップ
| 項目 | 内容 |
|------|------|
| Day | 1 |
| 見積もり | 1日 |
| 依存 | なし |
| 対応機能 | - |
| 作業内容 | Next.js 15プロジェクト作成、TypeScript設定、Tailwind CSS v4設定、Vitest設定、GitHub Actions CI設定、ESLint設定 |
| 完了条件 | `npm run dev` でページ表示、`npm test` でテスト実行、`npm run build` でビルド成功、CIが正常動作 |
| 参照ドキュメント | library-notes.md（セットアップ時の注意点） |

#### T-02: 型定義・定数定義
| 項目 | 内容 |
|------|------|
| Day | 2 |
| 見積もり | 0.5日 |
| 依存 | T-01 |
| 対応機能 | - |
| 作業内容 | `src/types/index.ts` に GameState, DrawHistory, DrawResult, PrizeConfig, PrizeEntry 等の型定義。`src/config/game-constants.ts` にゲーム定数定義 |
| 完了条件 | 全型が定義され、TypeScriptの型チェックが通る |
| 参照ドキュメント | api-design.md（型定義）、requirements-v1.1（セクション5） |

#### T-03: 確率テーブル定義
| 項目 | 内容 |
|------|------|
| Day | 2 |
| 見積もり | 0.5日 |
| 依存 | T-02 |
| 対応機能 | M-03の前提 |
| 作業内容 | `src/config/prize-config.ts` に2024年末ジャンボの確率テーブルを定義 |
| 完了条件 | 全等級のweight（本数/ユニット）が正確に設定され、合計が20,000,000になる |
| 参照ドキュメント | requirements-v1.1（セクション2） |

---

### Phase B: データ層（Day 3-5）

#### T-04: LocalStorageラッパー
| 項目 | 内容 |
|------|------|
| Day | 3 |
| 見積もり | 0.5日 |
| 依存 | T-02 |
| 対応機能 | M-11, M-13 |
| 作業内容 | `src/data/storage.ts` — get/set/remove/clear、LocalStorage利用可否判定、メモリフォールバック |
| 完了条件 | LocalStorage利用可能時は正常動作、非対応時はメモリで動作。テスト作成済み |
| 参照ドキュメント | api-design.md（セクション2-1）、error-handling.md（STORAGE分類） |

#### T-05: スキーママイグレーション
| 項目 | 内容 |
|------|------|
| Day | 4 |
| 見積もり | 0.5日 |
| 依存 | T-04 |
| 対応機能 | M-13 |
| 作業内容 | `src/data/migration.ts` — バージョンチェック、マイグレーション実行、失敗時のリセット |
| 完了条件 | バージョン一致時スキップ、不一致時マイグレーション、破損時リセットが動作。テスト作成済み |
| 参照ドキュメント | design-doc-v1（セクション4） |

#### T-06: GameState CRUD
| 項目 | 内容 |
|------|------|
| Day | 4 |
| 見積もり | 0.5日 |
| 依存 | T-04, T-05 |
| 対応機能 | M-01, M-11, M-14 |
| 作業内容 | `src/data/game-state.ts` — 読み込み/保存/リセット/初期値生成、バリデーション |
| 完了条件 | CRUD操作が正常動作、データ破損時にフォールバック。テスト作成済み |
| 参照ドキュメント | api-design.md（セクション2-2）、error-handling.md（DATA_CORRUPTION分類） |

#### T-08: DrawHistory CRUD
| 項目 | 内容 |
|------|------|
| Day | 5 |
| 見積もり | 0.5日 |
| 依存 | T-04 |
| 対応機能 | S-02, M-07 |
| 作業内容 | `src/data/draw-history.ts` — 読み込み/追加（FIFO 100件制限）/削除 |
| 完了条件 | CRUD操作が正常動作、100件超過時にFIFO削除。テスト作成済み |
| 参照ドキュメント | api-design.md（セクション2-3） |

---

### Phase C: ビジネスロジック層（Day 5-8）

#### T-07: 通貨管理ロジック
| 項目 | 内容 |
|------|------|
| Day | 5 |
| 見積もり | 0.5日 |
| 依存 | T-02 |
| 対応機能 | M-01, M-02 |
| 作業内容 | `src/lib/currency-manager.ts` — 購入可否判定、残高差し引き、当選金加算、購入額計算 |
| 完了条件 | 全関数が純粋関数として実装。正常系・エッジケース・境界値テスト作成済み |
| 参照ドキュメント | api-design.md（セクション1-2） |

#### T-09: 抽選エンジン
| 項目 | 内容 |
|------|------|
| Day | 6-7 |
| 見積もり | 1日 |
| 依存 | T-02, T-03 |
| 対応機能 | M-03 |
| 作業内容 | `src/lib/lottery-engine.ts` — 整数重み付きランダム抽選、10枚分の抽選実行 |
| 完了条件 | 固定乱数テストで全等級の選択を確認。大量試行テスト（ローカル）で確率分布が妥当 |
| 参照ドキュメント | api-design.md（セクション1-1）、test-strategy.md（セクション7） |

#### T-10: 資金補給ロジック
| 項目 | 内容 |
|------|------|
| Day | 7-8 |
| 見積もり | 0.5日 |
| 依存 | T-02 |
| 対応機能 | M-06 |
| 作業内容 | `src/lib/refill-manager.ts` — 補給要否判定（日付比較 + 残高チェック）、補給額加算 |
| 完了条件 | 日付変更直後/同日2回目/残高閾値境界のテスト作成済み |
| 参照ドキュメント | api-design.md（セクション1-3） |

#### T-11: 統計計算ロジック
| 項目 | 内容 |
|------|------|
| Day | 8 |
| 見積もり | 0.5日 |
| 依存 | T-02 |
| 対応機能 | M-07 |
| 作業内容 | `src/lib/stats-calculator.ts` — 回収率計算、等級別集計、合計当選額計算 |
| 完了条件 | ゼロ除算回避、空配列、大きな数値のテスト作成済み |
| 参照ドキュメント | api-design.md（セクション1-4） |

---

### Phase D: Hooks層（Day 8-9）

#### T-12: useGameState フック
| 項目 | 内容 |
|------|------|
| Day | 8-9 |
| 見積もり | 1日 |
| 依存 | T-06, T-07, T-09, T-10, T-11 |
| 対応機能 | M-01, M-02, M-03, M-06, M-07, M-14 |
| 作業内容 | `src/hooks/useGameState.ts` — ガチャ実行フロー、資金補給チェック、リセット、初回訪問管理 |
| 完了条件 | ガチャ実行→残高更新→保存の一連フローが動作。renderHookテスト作成済み |
| 参照ドキュメント | api-design.md（セクション4-1）、design-doc-v1（セクション3-1） |

#### T-13: useDrawHistory フック
| 項目 | 内容 |
|------|------|
| Day | 9 |
| 見積もり | 0.5日 |
| 依存 | T-08 |
| 対応機能 | S-02 |
| 作業内容 | `src/hooks/useDrawHistory.ts` — 履歴追加、FIFO管理、直近の結果取得 |
| 完了条件 | renderHookテスト作成済み |
| 参照ドキュメント | api-design.md（セクション4-2） |

---

### Phase E: UIコンポーネント（Day 9-12）

#### T-14: ガチャボタンUI
| 項目 | 内容 |
|------|------|
| Day | 9-10 |
| 見積もり | 0.5日 |
| 依存 | T-12 |
| 対応機能 | M-02 |
| 作業内容 | `src/components/GachaButton.tsx` — 10連ガチャ購入ボタン、残高不足時のdisabled、InsufficientFunds表示 |
| 完了条件 | ボタン押下でガチャ実行、残高不足でdisabled化＋メッセージ表示 |
| 参照ドキュメント | design-system.md（ボタン規約） |

#### T-15: 抽選結果表示
| 項目 | 内容 |
|------|------|
| Day | 10 |
| 見積もり | 0.5日 |
| 依存 | T-14 |
| 対応機能 | M-04 |
| 作業内容 | `src/components/DrawResultList.tsx` — 10枚分の結果一覧、等級バッジ、当選金額表示 |
| 完了条件 | 10枚分の結果が正しく表示。当選/ハズレが視覚的に区別可能 |
| 参照ドキュメント | design-system.md（等級カラー、バッジ規約） |

#### T-16: 当選演出
| 項目 | 内容 |
|------|------|
| Day | 10-11 |
| 見積もり | 1日 |
| 依存 | T-15 |
| 対応機能 | M-05 |
| 作業内容 | `src/components/DrawAnimation.tsx` — 当選/ハズレ2段階演出、CSSアニメーション、スキップ機能 |
| 完了条件 | 当選時は背景色変化+テキスト強調、ハズレは控えめ表示。スキップボタンで即時表示 |
| 参照ドキュメント | design-system.md（アニメーション仕様） |

#### T-17: 残高表示
| 項目 | 内容 |
|------|------|
| Day | 10-11 |
| 見積もり | 0.5日 |
| 依存 | T-12 |
| 対応機能 | M-01 |
| 作業内容 | `src/components/BalanceDisplay.tsx` — 現在の所持金（ぃえん）表示、大きなフォント |
| 完了条件 | 残高が常時表示され、ガチャ実行後にリアルタイム更新 |
| 参照ドキュメント | design-system.md（タイポグラフィ、残高表示） |

#### T-18: 累計収支パネル
| 項目 | 内容 |
|------|------|
| Day | 11 |
| 見積もり | 0.5日 |
| 依存 | T-12, T-17 |
| 対応機能 | M-07 |
| 作業内容 | `src/components/StatsPanel.tsx` — 累計購入額・当選額・回収率・等級別当選回数の表示 |
| 完了条件 | 全統計値が正しく表示。ガチャ実行後にリアルタイム更新 |
| 参照ドキュメント | design-system.md（カード規約） |

#### T-19: 資金補給通知
| 項目 | 内容 |
|------|------|
| Day | 11 |
| 見積もり | 0.5日 |
| 依存 | T-12 |
| 対応機能 | M-06 |
| 作業内容 | `src/components/RefillNotice.tsx` — 資金補給時のトースト/バナー通知 |
| 完了条件 | 補給実行時に「30,000ぃえんが補給されました」の通知が表示される |

#### T-20: ギャンブル依存注意喚起
| 項目 | 内容 |
|------|------|
| Day | 11-12 |
| 見積もり | 0.5日 |
| 依存 | T-01 |
| 対応機能 | M-08 |
| 作業内容 | `src/components/DisclaimerBanner.tsx`（常時表示）、`src/components/FirstVisitModal.tsx`（初回モーダル） |
| 完了条件 | 「シミュレーションです」が常時表示。初回アクセスでモーダル表示。相談窓口リンク設置 |
| 参照ドキュメント | legal-risk-analysis-v1（セクション2-6） |

#### T-21: 利用規約ページ
| 項目 | 内容 |
|------|------|
| Day | 12 |
| 見積もり | 0.5日 |
| 依存 | T-01 |
| 対応機能 | M-09 |
| 作業内容 | `src/app/terms/page.tsx` — 利用規約・免責事項の静的ページ |
| 完了条件 | 利用規約の全項目（legal-risk-analysis-v1 セクション3）が記載されている |
| 参照ドキュメント | legal-risk-analysis-v1（セクション3, 4） |

#### T-22: データリセット
| 項目 | 内容 |
|------|------|
| Day | 12 |
| 見積もり | 0.5日 |
| 依存 | T-12 |
| 対応機能 | M-14 |
| 作業内容 | `src/components/ResetButton.tsx` — 確認ダイアログ付きリセットボタン |
| 完了条件 | リセット確認ダイアログ表示→確認→全データ初期化→初回アクセス状態に復帰 |

#### T-23: エラーハンドリングUI
| 項目 | 内容 |
|------|------|
| Day | 12 |
| 見積もり | 0.5日 |
| 依存 | T-04 |
| 対応機能 | M-13 |
| 作業内容 | `src/components/ErrorBoundary.tsx` — ルートレベルのErrorBoundary、フォールバックUI |
| 完了条件 | 未キャッチエラー時にフォールバックUI表示。「再読み込み」「リセット」ボタン動作 |
| 参照ドキュメント | error-handling.md（セクション6） |

---

### Phase F: 仕上げ（Day 12-15）

#### T-24: レスポンシブ調整
| 項目 | 内容 |
|------|------|
| Day | 12-13 |
| 見積もり | 1日 |
| 依存 | T-14〜T-23の主要UI完成後 |
| 対応機能 | M-10 |
| 作業内容 | 全コンポーネントのレスポンシブ対応確認・調整。375px / 768px / 1024px / 1920px でレイアウト確認 |
| 完了条件 | 全ブレークポイントでレイアウト崩れなし |
| 参照ドキュメント | design-system.md（セクション8） |

#### T-25: SEO/OGP対応
| 項目 | 内容 |
|------|------|
| Day | 13 |
| 見積もり | 0.5日 |
| 依存 | T-01 |
| 対応機能 | M-12 |
| 作業内容 | `layout.tsx` にmetadata設定、OGP画像配置、favicon設定 |
| 完了条件 | OGP Debuggerで正しく表示される。favicon表示 |

#### T-26: テスト作成（ロジック層）
| 項目 | 内容 |
|------|------|
| Day | 13-14 |
| 見積もり | 1日 |
| 依存 | T-07, T-09, T-10, T-11 |
| 対応機能 | NFR-08 |
| 作業内容 | `src/lib/` の全モジュールのテスト。抽選ロジックの固定乱数テスト・大量試行テスト含む |
| 完了条件 | `src/lib/` のカバレッジ80%以上 |
| 参照ドキュメント | test-strategy.md（セクション2-1, 7） |
| 備考 | 各タスク(T-04〜T-11)で基本テストは作成済み。ここでは網羅的なテスト追加・カバレッジ確認 |

#### T-27: テスト作成（データ層・フック層）
| 項目 | 内容 |
|------|------|
| Day | 14 |
| 見積もり | 1日 |
| 依存 | T-04〜T-06, T-08, T-12, T-13 |
| 対応機能 | NFR-08 |
| 作業内容 | `src/data/` と `src/hooks/` のテスト追加。カバレッジ確認 |
| 完了条件 | `src/data/` カバレッジ80%以上、`src/hooks/` カバレッジ60%以上 |
| 参照ドキュメント | test-strategy.md（セクション2-1, 2-2） |

#### T-28: ブラウザテスト・最終調整
| 項目 | 内容 |
|------|------|
| Day | 14-15 |
| 見積もり | 1日 |
| 依存 | 全タスク |
| 対応機能 | 全体 |
| 作業内容 | 手動テストチェックリスト実行（test-strategy.md セクション2-3）、クロスブラウザ確認（Chrome/Safari/Edge）、パフォーマンス確認 |
| 完了条件 | 手動テストチェックリスト全項目クリア。主要ブラウザで動作確認。初回ロード3秒以内 |
| 参照ドキュメント | test-strategy.md（手動テストチェックリスト）、requirements-v1.1（NFR-01〜03） |

---

## Should機能（バッファ日に実装）

| タスク | 見積もり | 依存 | 対応機能 |
|--------|---------|------|---------|
| T-S1: SNSシェア（テキスト） | 0.5日 | T-15 | S-01 |
| T-S2: 当選履歴一覧 | 1日 | T-13 | S-02 |
| T-S3: 等級別当選演出 | 1.5日 | T-16 | S-03 |

---

## サマリー

| フェーズ | Day | タスク数 | 工数 |
|---------|-----|---------|------|
| A: 基盤構築 | 1-3 | 3 | 2日 |
| B: データ層 | 3-5 | 4 | 2日 |
| C: ビジネスロジック層 | 5-8 | 4 | 2.5日 |
| D: Hooks層 | 8-9 | 2 | 1.5日 |
| E: UIコンポーネント | 9-12 | 10 | 5日 |
| F: 仕上げ | 12-15 | 3 | 3.5日（テスト2日含む） |
| **合計** | **1-15** | **26** | **約13日（バッファ2日）** |

---

作成日: 2026-02-10
